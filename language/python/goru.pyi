from typing import Any, TypedDict, Coroutine
from asyncio import AbstractEventLoop

class FSEntry(TypedDict):
    name: str
    is_dir: bool
    size: int

class FSStatResult(TypedDict):
    name: str
    size: int
    is_dir: bool
    mod_time: int

# =============================================================================
# kv - Key-Value Store Module
# =============================================================================

class _KVModule:
    def get(self, key: str, *, default: str | None = None) -> str | None: ...
    def set(self, key: str, value: str) -> str: ...
    def delete(self, key: str) -> str: ...
    async def async_get(self, key: str, *, default: str | None = None) -> str | None: ...
    async def async_set(self, key: str, value: str) -> str: ...
    async def async_delete(self, key: str) -> str: ...

kv: _KVModule

# =============================================================================
# http - HTTP Client Module
# =============================================================================

class _HTTPResponse:
    status_code: int
    text: str
    @property
    def ok(self) -> bool: ...
    def json(self) -> Any: ...

class _HTTPModule:
    def get(self, url: str) -> _HTTPResponse: ...
    async def async_get(self, url: str) -> _HTTPResponse: ...

http: _HTTPModule

# =============================================================================
# fs - Filesystem Module
# =============================================================================

class _FSModule:
    def read_text(self, path: str) -> str: ...
    def read_json(self, path: str) -> Any: ...
    def write_text(self, path: str, content: str) -> str: ...
    def write_json(self, path: str, data: Any, *, indent: int | None = None) -> str: ...
    def listdir(self, path: str) -> list[FSEntry]: ...
    def exists(self, path: str) -> bool: ...
    def mkdir(self, path: str) -> str: ...
    def remove(self, path: str) -> str: ...
    def stat(self, path: str) -> FSStatResult: ...
    async def async_read_text(self, path: str) -> str: ...
    async def async_read_json(self, path: str) -> Any: ...
    async def async_write_text(self, path: str, content: str) -> str: ...
    async def async_listdir(self, path: str) -> list[FSEntry]: ...
    async def async_exists(self, path: str) -> bool: ...
    async def async_mkdir(self, path: str) -> str: ...
    async def async_remove(self, path: str) -> str: ...
    async def async_stat(self, path: str) -> FSStatResult: ...

fs: _FSModule

# =============================================================================
# Time
# =============================================================================

def time_now() -> float: ...

# =============================================================================
# Async Utilities
# =============================================================================

def run_async[T](coro: Coroutine[Any, Any, T]) -> T: ...

# =============================================================================
# Low-level Protocol (for custom host functions)
# =============================================================================

def _goru_call(fn: str, args: dict[str, Any]) -> Any: ...
def _async_call(fn: str, args: dict[str, Any]) -> Coroutine[Any, Any, Any]: ...
